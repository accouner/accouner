<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Cari Pedagang Twitter</title>
  <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
  <style>
    .fade-in {
      animation: fadeIn 0.4s ease-in-out;
    }
    @keyframes fadeIn {
      from { opacity: 0; transform: scale(0.95); }
      to { opacity: 1; transform: scale(1); }
    }
  </style>
</head>
<body class="bg-gray-100 text-gray-800">
  <div class="container mx-auto p-4 max-w-xl">
    <h1 class="text-2xl font-bold text-center mb-4">Cari Pedagang Twitter</h1>
    <input type="text" id="searchInput" placeholder="Cari usernameâ€¦" class="w-full px-4 py-2 border rounded-xl mb-4 focus:outline-none focus:ring-2 focus:ring-blue-400">

    <div id="results" class="space-y-4"></div>
  </div>

  <!-- Template Card -->
  <template id="card-template">
    <div class="bg-white shadow-md rounded-2xl p-4 fade-in">
      <div class="flex items-center justify-between">
        <!-- Nama + Verified -->
        <div class="flex items-center gap-2 text-lg font-semibold text-gray-800 min-w-0">
          <span class="name truncate">ğŸ‘¤ Nama Penjual</span>
          <span class="verified-icon shrink-0" title="Terverifikasi"></span>
        </div>
        <!-- Info Button -->
        <button class="text-blue-600 hover:text-blue-800 info-button shrink-0" title="Info">ğŸ›ˆ</button>
      </div>
      <div class="grid grid-cols-2 gap-2 mt-4 buttons-container"></div>
    </div>
  </template>

  <script>
    const API_URL = "/api"; // Pastikan endpoint ini benar

    async function loadData() {
      try {
        const res = await fetch(API_URL);
        const data = await res.json();
        return data.data || [];
      } catch (err) {
        console.error("Gagal memuat data:", err);
        return [];
      }
    }

    function createCard(entry) {
      const template = document.getElementById("card-template");
      const clone = template.content.cloneNode(true);

      clone.querySelector(".name").textContent = entry.Nama || "Tanpa Nama";

      if (entry.Terverifikasi === "TRUE" || entry.Terverifikasi === "Ya" || entry.Terverifikasi === true) {
        const verifiedSVG = `
          <svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5 text-blue-500" viewBox="0 0 24 24" fill="currentColor">
            <path d="M22.25 12.003c0 5.657-4.593 10.25-10.25 10.25s-10.25-4.593-10.25-10.25S6.343 1.753 12 1.753s10.25 4.593 10.25 10.25zm-6.878-2.628l-4.75 4.75-2.122-2.122-1.414 1.415 3.536 3.536 6.164-6.165-1.414-1.414z"/>
          </svg>
        `;
        clone.querySelector(".verified-icon").innerHTML = verifiedSVG;
      }

      const buttonsContainer = clone.querySelector(".buttons-container");

      if (entry.Twitter) {
        buttonsContainer.innerHTML += `
          <a href="${entry.Twitter}" target="_blank" class="bg-blue-500 hover:bg-blue-600 text-white py-2 px-4 rounded-xl text-center text-sm">
            ğŸŒ Twitter
          </a>`;
      }
      if (entry.WhatsApp) {
        buttonsContainer.innerHTML += `
          <a href="${entry.WhatsApp}" target="_blank" class="bg-green-500 hover:bg-green-600 text-white py-2 px-4 rounded-xl text-center text-sm">
            ğŸ“ WhatsApp
          </a>`;
      }
      if (entry.Telegram) {
        buttonsContainer.innerHTML += `
          <a href="${entry.Telegram}" target="_blank" class="bg-cyan-500 hover:bg-cyan-600 text-white py-2 px-4 rounded-xl text-center text-sm">
            âœ‰ï¸ Telegram
          </a>`;
      }

      // Tombol info klik
      const infoButton = clone.querySelector(".info-button");
      infoButton.addEventListener("click", () => {
        alert(`Info: ${entry.Nama || "Tanpa Nama"}\nUsername: ${entry.Username || "-"}\nVerified: ${entry.Terverifikasi || "-"}`);
      });

      return clone;
    }

    function displayResults(data, keyword = "") {
      const resultsContainer = document.getElementById("results");
      resultsContainer.innerHTML = "";

      const filtered = keyword
        ? data.filter(entry => (entry.Username || "").toLowerCase().includes(keyword.toLowerCase()))
        : data;

      if (filtered.length === 0) {
        resultsContainer.innerHTML = `<p class="text-center text-gray-500">Tidak ditemukan.</p>`;
        return;
      }

      resultsContainer.innerHTML = `<p class="text-center text-sm text-gray-500">${filtered.length} hasil ditemukan.</p>`;

      filtered.forEach(entry => {
        resultsContainer.appendChild(createCard(entry));
      });
    }

    document.getElementById("searchInput").addEventListener("input", async (e) => {
      const keyword = e.target.value;
      const data = await loadData();
      displayResults(data, keyword);
    });

    // Inisialisasi awal
    (async () => {
      const data = await loadData();
      displayResults(data);
    })();
  </script>
</body>
</html>
